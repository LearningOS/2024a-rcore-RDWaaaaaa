# Lab2总结

## 实现的功能
- 重写系统调用：由于引入虚存机制，重写 sys_get_time 和 sys_task_info 系统调用，以恢复其功能。
- sys_mmap 系统调用负责匿名内存映射，映射指定虚拟地址范围的物理内存，内存属性由 port 参数定义。sys_munmap 负责取消映射。两者要求满足页对齐，避免无效或重叠区间。

## 问答题
1. 请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？
VPN（虚拟页号）：指向下一层页表或最终物理页面。
PPN（物理页号）：映射到物理内存地址的页号。
标志位：包含多种标志位用于控制访问和权限。
V（Valid）：页表项是否有效，0 表示无效。
R/W/X（Read/Write/Execute）：控制页面的读、写和执行权限。
U（User）：用户模式是否可访问该页面。
A（Accessed）：页面是否已被访问，用于页面替换算法。
D（Dirty）：页面是否被修改过，用于写回到磁盘的判断。
2. 缺页
- 请问哪些异常可能是缺页导致的？
页面不存在异常：访问的页面不存在于页表中。
访问权限异常：页表中记录的页面权限不足，导致无法访问。
- 发生缺页时，描述相关重要寄存器的值，上次实验描述过的可以简略。
SATP：保存当前页表的物理基地址。
scause：指示中断类型及原因，缺页会产生存储页错误或指令页错误。
stval：保存缺页地址。
- Lazy 策略有哪些好处？
减少不必要的内存占用：避免为未访问页面分配内存。
提升效率：减少不必要的页面加载，优化内存使用。
- 处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？
10GB 连续内存对应的页表项约占用 40MB 左右
- 请简单思考如何才能实现 Lazy 策略，缺页时又如何处理？描述合理即可，不需要考虑实现。
Lazy 策略可通过延迟页表填充实现，初次访问时填充页表并加载内容。缺页时，MMU 产生缺页中断，OS 捕获中断，动态分配页面并更新页表。
- 缺页的另一个常见原因是 swap 策略，也就是内存页面可能被换到磁盘上了，此时页面失效如何表现在页表项(PTE)上？
页表项标志位的 V（Valid） 位被清除（设置为0），表示页面已失效。
3. 双页表与单页表
- 在单页表情况下，如何更换页表？
修改 SATP 寄存器以指向新页表。
- 单页表情况下，如何控制用户态无法访问内核页面？（tips:看看上一题最后一问）
设置 PTE 的 U（User） 位，确保用户态不能访问内核地址。
- 单页表有何优势？（回答合理即可）
减少切换页表的开销,用户态和内核态共享相同的地址空间，方便直接映射。
- 双页表实现下，何时需要更换页表？假设你写一个单页表操作系统，你会选择何时更换页表（回答合理即可）？
在双页表系统中，进出内核态时需要更换页表，以保护内核内存安全。若实现单页表设计，可在用户态切换到内核态或进程切换时更换页表。

## 荣誉准则
1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

《你交流的对象说明》

2. 此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

《你参考的资料说明》

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。
